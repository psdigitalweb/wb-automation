### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- Backend:
  - `src/app/db_marketplace_tariffs.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≥—Ä–µ–≥–∏—Ä—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ç–∞—Ä–∏—Ñ–æ–≤ `get_tariffs_status`.
  - `src/app/schemas/marketplaces.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã Pydantic‚Äë—Å—Ö–µ–º—ã –¥–ª—è WB Tariffs admin API:
    - `WBTariffsIngestRequest`, `WBTariffsIngestResponse`,
    - `WBTariffTypeStatus`, `WBTariffsStatusResponse`.
  - `src/app/routers/admin_marketplaces.py` ‚Äî –Ω–æ–≤—ã–π admin‚Äë—Ä–æ—É—Ç–µ—Ä –¥–ª—è marketplace‚Äë—É—Ä–æ–≤–Ω—è (WB tariffs).
  - `src/app/routers/admin_tasks.py` ‚Äî –±–µ–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –æ—Ä–∏–µ–Ω—Ç–∏—Ä admin‚Äë–ø–∞—Ç—Ç–µ—Ä–Ω–∞; –ø—Ä–∞–≤–∞ —á–µ—Ä–µ–∑ `get_current_superuser`).
  - `src/app/main.py` ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞ `admin_marketplaces_router`.
- Frontend:
  - `frontend/app/app/admin/marketplaces/wildberries/tariffs/page.tsx` ‚Äî –Ω–æ–≤—ã–π admin UI –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ WB –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞.
- Tests / utils:
  - `test_admin_wb_tariffs.py` ‚Äî –±–∞–∑–æ–≤—ã–µ pytest‚Äë—Ç–µ—Å—Ç—ã admin‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞.

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ endpoints

#### 1. –ó–∞–ø—É—Å–∫ ingestion —Ç–∞—Ä–∏—Ñ–æ–≤ WB (admin)

- **–ú–µ—Ç–æ–¥ –∏ –ø—É—Ç—å**:  
  `POST /api/v1/admin/marketplaces/wildberries/tariffs/ingest`

- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**:  
  –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ Celery‚Äë–∑–∞–¥–∞—á–∏ `ingest_wb_tariffs_all_task` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ Wildberries –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ (–æ–±—â–∏—Ö –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤).

- **–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON)**:

```json
{
  "days_ahead": 14
}
```

- `days_ahead`:
  - —Ç–∏–ø: `int`,
  - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `14`,
  - –¥–∏–∞–ø–∞–∑–æ–Ω: `0..30`,
  - –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥ (–≤–∫–ª—é—á–∞—è —Å–µ–≥–æ–¥–Ω—è) –∑–∞–±–∏—Ä–∞—Ç—å —Ç–∞—Ä–∏—Ñ—ã (–¥–∏–∞–ø–∞–∑–æ–Ω `today .. today + days_ahead`).

- **–û—Ç–≤–µ—Ç (202 Accepted)**:

```json
{
  "status": "started",
  "days_ahead": 14,
  "task": "ingest_wb_tariffs_all"
}
```

- **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**:
  - —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Depends(get_current_superuser)` (—Å–º. `app.deps.get_current_superuser`),
  - —Ç–æ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å `is_superuser = True`,
  - –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∞–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `403 Forbidden` —Å detail `"Not enough permissions"`.

- **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞**:
  - –≤–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è `ingest_wb_tariffs_all_task` –∏–∑ `app.tasks.wb_tariffs`,
  - —Å—Ç–∞–≤–∏—Ç—Å—è –∑–∞–¥–∞—á–∞ –≤ –æ—á–µ—Ä–µ–¥—å —á–µ—Ä–µ–∑:

    ```python
    result = ingest_wb_tariffs_all_task.delay(days_ahead=body.days_ahead)
    ```

  - –≤ –ª–æ–≥ (`logging.getLogger(__name__)`) –ø–∏—à–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞ —Å:
    - `user_id`, `username`, `email` –∑–∞–ø—É—Å–∫–∞—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
    - –∑–Ω–∞—á–µ–Ω–∏–µ–º `days_ahead`,
    - `task_id` Celery‚Äë–∑–∞–¥–∞—á–∏ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω).

#### 2. –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ç–∞—Ä–∏—Ñ–æ–≤ WB (admin)

- **–ú–µ—Ç–æ–¥ –∏ –ø—É—Ç—å**:  
  `GET /api/v1/admin/marketplaces/wildberries/tariffs/status`

- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**:  
  –í–µ—Ä–Ω—É—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–Ω–∞–ø—à–æ—Ç–∞—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ Wildberries (marketplace‚Äëlevel), –ø–æ –≤—Å–µ–º —Ç–∏–ø–∞–º —Ç–∞—Ä–∏—Ñ–æ–≤.

- **–û—Ç–≤–µ—Ç (200 OK)**:

```json
{
  "marketplace_code": "wildberries",
  "data_domain": "tariffs",
  "latest_fetched_at": "2026-01-20T03:31:45.123456+00:00",
  "types": {
    "commission": {
      "latest_fetched_at": "2026-01-20T03:31:45.123456+00:00",
      "latest_as_of_date": null,
      "locale": "ru"
    },
    "acceptance_coefficients": {
      "latest_fetched_at": "2026-01-20T03:31:46.000000+00:00",
      "latest_as_of_date": null,
      "locale": null
    },
    "box": {
      "latest_fetched_at": "2026-01-20T03:32:00.000000+00:00",
      "latest_as_of_date": "2026-02-03",
      "locale": null
    },
    "pallet": {
      "latest_fetched_at": "2026-01-20T03:32:10.000000+00:00",
      "latest_as_of_date": "2026-02-03",
      "locale": null
    },
    "return": {
      "latest_fetched_at": "2026-01-20T03:32:20.000000+00:00",
      "latest_as_of_date": "2026-02-03",
      "locale": null
    }
  }
}
```

- –ü–æ–ª—è:
  - **–ö–æ—Ä–Ω–µ–≤—ã–µ**:
    - `marketplace_code` ‚Äî –≤—Å–µ–≥–¥–∞ `'wildberries'` –≤ —Ç–µ–∫—É—â–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏,
    - `data_domain` ‚Äî `'tariffs'`,
    - `latest_fetched_at` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ `fetched_at` —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π `marketplace_api_snapshots` –¥–ª—è `(marketplace_code='wildberries', data_domain='tariffs')`.
  - **types**:
    - `commission`:
      - `latest_fetched_at` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π `fetched_at` –ø–æ `data_type='commission'`,
      - `latest_as_of_date` ‚Äî –≤—Å–µ–≥–¥–∞ `null`,
      - `locale` ‚Äî —è–∑—ã–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–Ω–∞–ø—à–æ—Ç–∞ (–æ–±—ã—á–Ω–æ `'ru'`).
    - `acceptance_coefficients`:
      - `latest_fetched_at` ‚Äî –º–∞–∫—Å–∏–º—É–º –ø–æ `data_type='acceptance_coefficients'`,
      - `latest_as_of_date` ‚Äî `null`,
      - `locale` ‚Äî `null`.
    - `box` / `pallet` / `return`:
      - `latest_fetched_at` ‚Äî –º–∞–∫—Å–∏–º—É–º `fetched_at` –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É `data_type`,
      - `latest_as_of_date` ‚Äî –º–∞–∫—Å–∏–º—É–º `as_of_date` –ø–æ —ç—Ç–æ–º—É `data_type` (–ø–æ—Å–ª–µ–¥–Ω—è—è –¥–∞—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –µ—Å—Ç—å —Ç–∞—Ä–∏—Ñ—ã),
      - `locale` ‚Äî `null`.

- **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**:
  - —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ ingest‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Depends(get_current_superuser)`,
  - –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è `is_superuser = True`, –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ ‚Äî `403 Forbidden`.

- **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞**:
  - –≤—ã–∑—ã–≤–∞–µ—Ç `get_tariffs_status(marketplace_code='wildberries', data_domain='tariffs')`,
  - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–∞–ø–∏—Ç—Å—è –≤ `WBTariffsStatusResponse` (Pydantic) –∏ –æ—Ç–¥–∞—ë—Ç—Å—è –∫–∞–∫ JSON.

### –õ–æ–≥–∏–∫–∞ –ø—Ä–∞–≤ (–∫–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è admin)

- –í—Å—è admin‚Äë—á–∞—Å—Ç—å (–Ω–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≤ –ø—Ä–æ–µ–∫—Ç–µ –º–µ—Ö–∞–Ω–∏–∑–º:
  - `app.deps.get_current_user` ‚Äî —á–∏—Ç–∞–µ—Ç JWT access token, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å/—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `username`/`user_id`,
  - `app.deps.get_current_active_user` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `is_active`,
  - **`app.deps.get_current_superuser`** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `is_superuser`:

    ```python
    async def get_current_superuser(current_user: dict = Depends(get_current_active_user)) -> dict:
        if not current_user.get("is_superuser"):
            raise HTTPException(
                status_code=status.HTTP_403_FORBIDDEN,
                detail="Not enough permissions"
            )
        return current_user
    ```

- –ù–æ–≤—ã–µ admin‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è WB tariffs **—Å—Ç—Ä–æ–≥–æ –∑–∞–≤—è–∑–∞–Ω—ã** –Ω–∞ `get_current_superuser`, –ø–æ—ç—Ç–æ–º—É:
  - UI‚Äë—Å–∫—Ä—ã—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–µ—Ö–∞–Ω–∏–∑–º–æ–º –∑–∞—â–∏—Ç—ã, –∞ —Ç–æ–ª—å–∫–æ UX,
  - –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä—è–º–æ–º –≤—ã–∑–æ–≤–µ API –∫–ª–∏–µ–Ω—Ç–æ–º –±–µ–∑ UI –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `is_superuser` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 403 –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã—Ö –ø—Ä–∞–≤–∞—Ö.

### –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

- **–ß–µ—Ä–µ–∑ –≤–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é (Topbar)**:
  - –í `Topbar` –¥–ª—è superuser‚Äë–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`is_superuser = true`) –ø–æ–∫–∞–∑–∞–Ω–∞ —Å—Å—ã–ª–∫–∞:
    - —Ç–µ–∫—Å—Ç: `Admin: WB Tariffs`,
    - `href="/app/admin/marketplaces/wildberries/tariffs"`.
  - –ö–ª–∏–∫ –ø–æ –Ω–µ–π –≤–µ–¥—ë—Ç –Ω–∞ admin‚Äë—Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–∞—Ä–∏—Ñ–æ–≤ WB.

- **URL –æ—Å–Ω–æ–≤–Ω–æ–π admin‚Äë—Å—Ç—Ä–∞–Ω–∏—Ü—ã**:
  - —Ñ–∞–π–ª: `frontend/app/app/admin/marketplaces/wildberries/tariffs/page.tsx`,
  - –º–∞—Ä—à—Ä—É—Ç: `/app/admin/marketplaces/wildberries/tariffs`,
  - –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `is_superuser = true` (–ø—Ä–æ—á–∏–º –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞ ‚Äú–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤‚Ä¶‚Äù).

- **Admin‚Äë—Å–µ–∫—Ü–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞**:
  - —Ñ–∞–π–ª: `frontend/app/app/project/[projectId]/marketplaces/page.tsx`,
  - URL: `/app/project/{projectId}/marketplaces`,
  - –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫:

    ```text
    üîí Admin (–≥–ª–æ–±–∞–ª—å–Ω–æ, –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤)
    Wildberries ‚Äî Tariffs

    [ Days ahead (0‚Äì30) ] [ –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã WB ] [ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å ]
    ```

  - –±–ª–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è superuser‚Äë–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ `/api/v1/auth/me`),
  - –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ admin‚ÄëAPI (`/v1/admin/marketplaces/wildberries/tariffs/ingest` –∏ `/status`),
  - –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–ª–æ–∫ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è.

### UI: –≥–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∏ –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ (admin‚Äë—Å—Ç—Ä–∞–Ω–∏—Ü–∞)**:
  - admin‚Äë—ç–∫—Ä–∞–Ω: `frontend/app/app/admin/marketplaces/wildberries/tariffs/page.tsx`,
  - –º–∞—Ä—à—Ä—É—Ç Next.js: `/app/admin/marketplaces/wildberries/tariffs`,
  - –¥–æ—Å—Ç–∏–∂–∏–º —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫—É ‚ÄúAdmin: WB Tariffs‚Äù –≤ Topbar,
  - –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ ‚ÄúWildberries ‚Äî Tariffs (Admin, global)‚Äù.

- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ UI**:
  - –°–µ–∫—Ü–∏—è ‚Äú–°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è‚Äù:
    - –ó–∞–≥–æ–ª–æ–≤–æ–∫: `Wildberries ‚Äî Tariffs (Admin, global)`,
    - —Å—Ç—Ä–æ–∫–∞ —Å –æ–±—â–∏–º `latest_fetched_at`,
    - —Ç–∞–±–ª–∏—Ü–∞ –ø–æ —Ç–∏–ø–∞–º (`commission`, `acceptance_coefficients`, `box`, `pallet`, `return`) —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏:
      - –¢–∏–ø,
      - –ü–æ—Å–ª–µ–¥–Ω–∏–π `fetched_at`,
      - –ü–æ—Å–ª–µ–¥–Ω–∏–π `as_of_date`,
      - Locale.
    - –ö–Ω–æ–ø–∫–∞ `–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å`, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç `GET /v1/admin/marketplaces/wildberries/tariffs/status`.
  - –°–µ–∫—Ü–∏—è ‚Äú–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ WB‚Äù:
    - –ü–æ–ª–µ `Days ahead (0‚Äì30)` ‚Äî `input type="number"`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `14`, –¥–∏–∞–ø–∞–∑–æ–Ω 0‚Äì30 (–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –∏ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ),
    - –ö–Ω–æ–ø–∫–∞ `–û–±–Ω–æ–≤–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã WB`, –ø–æ –∫–ª–∏–∫—É:
      - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /v1/admin/marketplaces/wildberries/tariffs/ingest` —Å `{ "days_ahead": <–∑–Ω–∞—á–µ–Ω–∏–µ> }`,
      - –¥–∏–∑–µ–π–±–ª–∏—Ç –∫–Ω–æ–ø–∫—É/–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ `–ó–∞–ø—É—Å–∫...`,
      - –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–µ–ª—ë–Ω—ã–π —Ç–µ–∫—Å—Ç `–ó–∞–ø—É—â–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤ (days_ahead=...)`,
      - —á–µ—Ä–µ–∑ ~2.5 —Å–µ–∫—É–Ω–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å (`/status`).

- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∞–≤**:
  - –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `getUser()` –∏–∑ `frontend/lib/auth.ts`:
    - –µ—Å–ª–∏ `user?.is_superuser` **–ª–æ–∂—å**:
      - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: ‚Äú–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞. –¢—Ä–µ–±—É—é—Ç—Å—è admin/superuser –ø—Ä–∞–≤–∞.‚Äù,
      - –∫–Ω–æ–ø–∫–∞ –∏ —Å—Ç–∞—Ç—É—Å‚Äë—Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è.
    - –µ—Å–ª–∏ `user?.is_superuser` **–∏—Å—Ç–∏–Ω–∞**:
      - –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –æ–±–µ —Å–µ–∫—Ü–∏–∏ (—Å—Ç–∞—Ç—É—Å + –∫–Ω–æ–ø–∫–∞),
      - –ø—Ä–∏ –æ—à–∏–±–∫–µ 401/403 –æ—Ç –±—ç–∫–µ–Ω–¥–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äú–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ (—Ç—Ä–µ–±—É–µ—Ç—Å—è admin/superuser).‚Äù

- **–û–±—Ä–∞—â–µ–Ω–∏—è –∫ API –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ**:
  - —Å—Ç–∞—Ç—É—Å: `apiGet<WBTariffsStatusResponse>('/v1/admin/marketplaces/wildberries/tariffs/status')`,
  - –∑–∞–ø—É—Å–∫: `apiPost<IngestResponse>('/v1/admin/marketplaces/wildberries/tariffs/ingest', { days_ahead })`,
  - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
    - –µ—Å–ª–∏ `ApiError.status` 401/403 ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —á–µ–ª–æ–≤–µ–∫–æ–ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–∞–≤–∞—Ö,
    - –∏–Ω–∞—á–µ ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ `detail` –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç.

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä—É—á–Ω—É—é

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**:
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ –ë–î –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å `is_superuser = true` –∏ –æ–Ω –º–æ–∂–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ç–µ–∫—É—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º auth (–ø–æ–ª—É—á–∏—Ç—å JWT —á–µ—Ä–µ–∑ `/api/v1/auth/login`).
   - –û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (Next.js dev‚Äë—Å–µ—Ä–≤–µ—Ä) –∏ –±—ç–∫–µ–Ω–¥ (FastAPI + Celery).

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ admin‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤**:
   - –ó–∞–π—Ç–∏ –ø–æ–¥ **–Ω–µ‚Äëadmin** JWT –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å:
     - `POST /api/v1/admin/marketplaces/wildberries/tariffs/ingest` ‚Üí –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å `403 Forbidden`,
     - `GET /api/v1/admin/marketplaces/wildberries/tariffs/status` ‚Üí —Ç–∞–∫–∂–µ `403 Forbidden`.
   - –ó–∞–π—Ç–∏ –ø–æ–¥ **admin/superuser** JWT:
     - `GET /api/v1/admin/marketplaces/wildberries/tariffs/status` ‚Üí –ø–æ–ª—É—á–∏—Ç—å JSON —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –æ–ø–∏—Å–∞–Ω–Ω–æ–π –≤—ã—à–µ (–µ—Å–ª–∏ —Å–Ω–∞–ø—à–æ—Ç–æ–≤ –µ—â—ë –Ω–µ—Ç, –≤—Å–µ –ø–æ–ª—è –º–æ–≥—É—Ç –±—ã—Ç—å `null`),
     - `POST /api/v1/admin/marketplaces/wildberries/tariffs/ingest` —Å —Ç–µ–ª–æ–º `{ "days_ahead": 14 }`:
       - –ø–æ–ª—É—á–∏—Ç—å `202 Accepted` –∏ —Ç–µ–ª–æ `{ "status": "started", "days_ahead": 14, "task": "ingest_wb_tariffs_all" }`,
       - –≤ Celery‚Äë–ª–æ–≥–∞—Ö —É–≤–∏–¥–µ—Ç—å –ø–æ—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–¥–∞—á–∏,
       - –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –µ—â—ë —Ä–∞–∑ –≤—ã–∑–≤–∞—Ç—å `/status` –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `latest_fetched_at` –æ–±–Ω–æ–≤–∏–ª—Å—è, –∞ –ø–æ —Ç–∏–ø–∞–º –ø–æ—è–≤–∏–ª–∏—Å—å –∑–Ω–∞—á–µ–Ω–∏—è.

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ UI**:
   - –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –ø–æ–¥ **–Ω–µ‚Äëadmin** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:
     - –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ `/app/admin/marketplaces/wildberries/tariffs`,
     - —É–≤–∏–¥–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –ø—Ä–∞–≤, –∫–Ω–æ–ø–∫–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è.
   - –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –ø–æ–¥ **admin/superuser**:
     - –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ `/app/admin/marketplaces/wildberries/tariffs`,
     - —É–≤–∏–¥–µ—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º (–∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äú–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö‚Äù –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ),
     - –∑–∞–¥–∞—Ç—å `Days ahead`, –Ω–∞–∂–∞—Ç—å `–û–±–Ω–æ–≤–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã WB`,
     - —É–≤–∏–¥–µ—Ç—å –∑–µ–ª—ë–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—É—Å–∫–µ,
     - —á–µ—Ä–µ–∑ 2‚Äì3 —Å–µ–∫—É–Ω–¥—ã —Å—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å—Å—è (–ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ Celery‚Äë—Ç–∞—Å–∫–∞ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∞ –∏ –¥–∞–Ω–Ω—ã–µ –ø–æ—è–≤–∏–ª–∏—Å—å).

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π `days_ahead`**:
   - –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –≤–≤–µ—Å—Ç–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ >30:
     - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —á–∏—Å–ª–æ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π (0..30),
     - –±—ç–∫–µ–Ω–¥ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç `ge=0`, `le=30`, –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –≤–µ—Ä–Ω—ë—Ç 422 (validation error).

### –¢–µ—Å—Ç—ã: —á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –∏ –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å

- **–§–∞–π–ª —Ç–µ—Å—Ç–æ–≤**: `test_admin_wb_tariffs.py`

- **–¢–µ—Å—Ç—ã**:
  1. `test_wb_tariffs_ingest_requires_admin`:
     - –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `get_current_superuser` –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –≤—Å–µ–≥–¥–∞ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `HTTPException(403, "Not enough permissions")`,
     - –¥–µ–ª–∞–µ—Ç `POST /api/v1/admin/marketplaces/wildberries/tariffs/ingest`,
     - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ `403 Forbidden`.
  2. `test_wb_tariffs_ingest_admin_starts_task`:
     - —á–µ—Ä–µ–∑ `monkeypatch` –ø–æ–¥–º–µ–Ω—è–µ—Ç `ingest_wb_tariffs_all_task.delay` –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è:
       - –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Ñ–∞–∫—Ç –≤—ã–∑–æ–≤–∞ –∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ `days_ahead`,
       - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å `id="test-task-id"`,
     - –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `get_current_superuser` —Ç–∞–∫, —á—Ç–æ–±—ã –≤–æ–∑–≤—Ä–∞—â–∞–ª—Å—è ‚Äúadmin‚Äù –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å `is_superuser=True`,
     - –≤—ã–∑—ã–≤–∞–µ—Ç `POST /api/v1/admin/marketplaces/wildberries/tariffs/ingest` —Å `days_ahead=5`,
     - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
       - —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ `202`,
       - —Ç–µ–ª–æ `{ "status": "started", "days_ahead": 5, "task": "ingest_wb_tariffs_all" }`,
       - —á—Ç–æ –∑–∞–º–æ–∫–∞–Ω–Ω—ã–π `delay` –±—ã–ª –≤—ã–∑–≤–∞–Ω –∏ –ø–æ–ª—É—á–∏–ª `days_ahead == 5`.

- **–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤**:
  - –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `pytest` –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.
  - –ó–∞–ø—É—Å–∫ –∏–∑ –∫–æ—Ä–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

    ```bash
    pytest -q
    ```

  - –ï—Å–ª–∏ `pytest` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∫–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –æ—à–∏–±–∫–æ–π ‚Äúpytest: command not found‚Äù; –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –µ–≥–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ dev‚Äë–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—É—Å–∫. 

